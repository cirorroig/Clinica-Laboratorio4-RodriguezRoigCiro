<div class="container mt-4">
  <h2 class="mb-4">Mis Pacientes</h2>

  <!-- Spinner mientras carga -->
  <div *ngIf="isLoading" class="d-flex justify-content-center align-items-center" style="min-height: 200px;">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <!-- Mensaje cuando no hay pacientes y no está cargando -->
  <div class="alert alert-info" *ngIf="!isLoading && !pacientes.length">
    No hay pacientes atendidos aún.
  </div>

  <!-- Lista de pacientes -->
  <div id="pacientesAccordion" class="accordion" *ngIf="!isLoading">
    <div class="accordion-item" *ngFor="let paciente of pacientes; let i = index">
      <h2 class="accordion-header">
        <button class="accordion-button" type="button" (click)="toggleExpand(i)" [class.collapsed]="!isExpanded(i)">
          {{paciente.nombre}} {{paciente.apellido}} - {{paciente.edad}} años
        </button>
      </h2>

      <div class="accordion-collapse collapse" [id]="'collapse' + i" [class.show]="isExpanded(i)">
        <div class="accordion-body">
          <div class="mb-3">
            <strong>Email:</strong> {{paciente.email}}
          </div>

          <h5 class="mt-4">Historial de Consultas</h5>

          <div class="list-group">
            <div class="list-group-item" *ngFor="let turno of paciente.turnos">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0">{{turno.fecha | date:'dd/MM/yyyy'}} - {{turno.hora}}</h6>
                <span class="badge bg-primary">{{turno.especialidad}}</span>
              </div>

              <div class="row g-3">
                <div class="col-md-3" *ngIf="turno.altura">
                  <strong>Altura:</strong> {{turno.altura}} cm
                </div>
                <div class="col-md-3" *ngIf="turno.peso">
                  <strong>Peso:</strong> {{turno.peso}} kg
                </div>
                <div class="col-md-3" *ngIf="turno.temperatura">
                  <strong>Temperatura:</strong> {{turno.temperatura}}°C
                </div>
                <div class="col-md-3" *ngIf="turno.presion">
                  <strong>Presión:</strong> {{turno.presion}}
                </div>
              </div>

              <div class="mt-3" *ngIf="hasDatosDinamicos(turno.datosDinamicos)">
                <h6>Datos Adicionales</h6>
                <div class="row g-3">
                  <div class="col-md-4" *ngFor="let dato of turno.datosDinamicos">
                    <div *ngIf="dato.clave != null && dato.valor != null">
                      <strong>{{dato.clave}}:</strong> {{dato.valor}}
                    </div>
                  </div>
                </div>
              </div>

              <div class="mt-3" *ngIf="turno.diagnostico">
                <h6>Diagnóstico</h6>
                <p>{{turno.diagnostico}}</p>
              </div>

              <div class="mt-3" *ngIf="turno.comentarioAtencion">
                <h6>Comentarios</h6>
                <p>{{turno.comentarioAtencion}}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>